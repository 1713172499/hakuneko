# Microsoft Azure Build Pipeline
# https://docs.microsoft.com/en-us/azure/devops/pipelines/yaml-schema?view=azure-devops&tabs=schema

# https://docs.microsoft.com/en-us/azure/devops/pipelines/build/triggers?view=azure-devops
pr: none
trigger:
  batch: true
  branches:
    include:
    - master

jobs:
- job: Windows
  pool:
    vmImage: 'windows-latest'
  steps:
  - template: azure-pipelines-ci-template.yml
    parameters:
      export: ''

- job: Ubuntu
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  # Problem with electron tests not running:
  # https://github.com/Microsoft/azure-pipelines-image-generation/issues/239
  # This snippet has partially been stolen from VSCode to fix running electron on Ubuntu
  - script: |
      set -e
      sudo apt-get update
      sudo apt-get install -y libxkbfile-dev pkg-config libsecret-1-dev libxss1 dbus xvfb libgtk-3-0
      disown -ar
    displayName: 'Starting X Virtual Frame Buffer (Port 99)'
  #- script: sudo apt-get update && sudo apt-get install libgconf-2-4 -y
  #  displayName: Install libgconf Dependency for electron
  - template: azure-pipelines-ci-template.yml
    parameters:
      export: 'DISPLAY=:99' # Configure WSL to redirect XDisplay output to windows host

- job: macOS
  pool:
    vmImage: 'macOS-latest'
  steps:
  - template: azure-pipelines-ci-template.yml
    parameters:
      export: ''