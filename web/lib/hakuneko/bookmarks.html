<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../polymer/lib/elements/dom-repeat.html">
<link rel="import" href="theme.html">

<dom-module id="hakuneko-bookmarks">

    <template>
        <style include="theme"></style>
        <style>
            :host {
            }
            .show {
                display: block;
            }
            .hide {
                display: none;
            }
            .bookmark {
                cursor: pointer;
                color: var(--manga-bookmark-button-color);
                text-shadow: var(--manga-bookmark-button-shadow);
            }
            #popup {
                position: absolute;
                cursor: default;
                text-shadow: initial;
                color: initial;
                border: 1px solid black;
                background-color: aliceblue;
                padding: 0.25em;
            }
            .manga {
                font-weight: bold;
                text-align: left;
            }
            .connector {
                color: #808080;
                text-align: right;
            }
            .button {
                cursor: pointer;
            }
        </style>
        <div>
            <i class="fa fa-fw fa-star bookmark" on-mouseover="showBookmarks" on-mouseout="hideBookmarks">
            <table id="popup" class$="[[ getPopupClass(showPopup) ]]">
                <tr class="[[ getNewBookmarkClass(selectedConnector,selectedManga) ]]">
                    <td class="manga">[[ selectedManga.title ]]</td>
                    <td class="connector">[[ selectedConnector.label ]]</td>
                    <td><i class="fa fa-fw fa-plus-circle button" title="Add select manga to bookmarks" on-click="addBookmark"></i></td>
                </tr>
                <tr>
                    <td colspan="3"><hr></td>
                </tr>
                <template is="dom-repeat" items="[[ bookmarkList ]]">
                    <tr>
                        <td class="manga"><span class="button">[[ item.title.manga ]]</span></td>
                        <td class="connector">[[ item.title.connector ]]</td>
                        <td><i class="fa fa-fw fa-minus-circle button" title="Remove manga from bookmarks" on-click="deleteBookmark"></i></td>
                    </tr>
                </template>
            </table>
            </i>
        </div>
    </template>

    <script>
        /** @polymerElement */
        class HakunekoBookmarks extends Polymer.Element {
            /**
             *
             */
            static get is() {
                return 'hakuneko-bookmarks';
            }

            /**
             *
             */
            static get properties() {
                return {
                    selectedConnector: {
                        type: Object,
                        notify: true,
                        value: undefined
                    },
                    selectedManga: {
                        type: Object,
                        notify: true,
                        value: undefined
                    }
                };
            }

            /**
             *
             */
            ready() {
                super.ready();
                this.showPopup = false;
                this.bookmarkList = Engine.BookmarkManager.load();
                console.log( this.bookmarks );
            }

            /**
             *
             */
            getNewBookmarkClass( connector, manga ) {
                if( !connector || !manga ) {
                    return 'hide';
                }
                return 'show';
            }

            /**
             *
             */
            getPopupClass(showPopup) {
                return ( showPopup ? 'show' : 'hide' );
            }

            /**
             *
             */
            showBookmarks() {
                this.set( 'showPopup', true );
            }

            /**
             *
             */
            hideBookmarks() {
                this.set( 'showPopup', false );
            }

            /**
             *
             */
            addBookmark( e ) {
                console.log( 'add bookmark', this.selectedManga );
            }

            /**
             *
             */
            deleteBookmark( e ) {
                console.log( 'delete bookmark', e.model.item.id, e.model.item.key );
            }
        }
        window.customElements.define(HakunekoBookmarks.is, HakunekoBookmarks);
    </script>

</dom-module>