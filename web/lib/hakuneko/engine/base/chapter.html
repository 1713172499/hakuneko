<script>

    /**
     *
     */
    class Chapter {

        /**
         *
         */
        constructor( manga, id, title, language ) {
            this.manga = manga;
            this.id = id;
            this.title = title;
            this.language = language;
            this.status = undefined;
            this.pageProcess = false;
            this.pageCache = undefined;
            this.updateStatus();
        }

        /**
         *
         */
        setStatus( status ) {
            if( this.status !== status ) {
                this.status = status;
                document.dispatchEvent( new CustomEvent( EventListener.onChapterStatusChanged, { detail: this } ) );
            }
        }

        /**
         * 
         */
        updateStatus() {
            // do not overwrite download status ...
            if( !this.status || this.status === DownloadStatus.available || this.status === DownloadStatus.completed) {
                Engine.Storage.getChapterStatus( this, this.setStatus.bind( this ) );
            }
        }

        /**
         * Get all pages for the chapter.
         * Callback will be executed after completion and provided with a reference to the page list (undefined on error).
         */
        getPages( callback ) {
            if( this.status === DownloadStatus.completed ) {
                Engine.Storage.loadChapterPages( this, callback );
            } else {
            // check if page list is cached
                if( this.pageCache ) {
                    callback( this.pageCache );
                    return;
                }
                // get page list directly from the connector interface and cache them
                this.manga.connector._getPageList( this.manga, this, ( pages ) => {
                    this.pageCache = pages;
                    callback( this.pageCache );
                });
            }
        }

    }
    Chapter; // reference the class to prevent removal of the class through js-minify

</script>