<script>

    /**
     * A promise provides control over one or more asynchronous functions, that needs to be awaited until each of them is finished.
     */
    class Promise {

        /**
         * Initialize a new promise with a callback function that should be executed, after all promises are resolved.
         */
        constructor( callback ) {
            this.keys = [];
            this.callback = callback;
        }

        /**
         * Add a new promise and return a key that can be used to resolve the promise.
         */
        defer() {
            let key = Symbol();
            this.keys.push( key );
            return key;
        }

        /**
         * Resolve a promise and execute the promise's callback when all promises have been resolved.
         */
        resolve( key ) {
            let index = this.keys.indexOf( key );
            this.keys.splice( index, 1 );
            if( this.keys.length === 0 ) {
                this.callback();
            }
        }
    }
    Promise; // reference the class to prevent removal of the class through js-minify

</script>