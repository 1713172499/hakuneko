<link rel="import" href="bookmark.html">

<script>

    /**
     * 
     */
    class BookmarkImporter {

        constructor() {
            //
        }

        /**
         *
         */
        importBookmarks( files ) {
            if( !files ) {
                throw new Error( 'No file(s) provided' );
            }
            for( let file of files ) {
                console.log( 'File:', file.type, file.name );
                if( file.size < 2 ) {
                    throw new Error( `Invalid file size: ${file.size}` );
                }
                if( file.type === 'application/json' || file.name.endsWith( '.json' ) ) {
                    this._importBoommarksJSON( file );
                }
                if( file.type === 'application/x-sqlite3' || file.name.endsWith( '.db' ) ) {
                    this._importBookmarksFMD( file );
                }
            }
        }

        /**
         *
         */
        _importBoommarksJSON( file ) {
            throw new Error( 'Not implemented!' );
            /*
            console.log( '_importBoommarksJSON' );
            let fileReader = new FileReader();
            fileReader.onload = event => {
                console.log( 'File Loaded (JSON)', event.currentTarget.result );
            };
            fileReader.readAsText( file );
            */
        }

        /**
         *
         */
        _importBookmarksFMD( file ) {
            console.log( '_importBookmarksFMD' );
            let fileReader = new FileReader();
            fileReader.onload = event => {
                console.log( 'File Loaded (SQLite3)', event.currentTarget.result );
                let db = new window.SQL.Database( new Uint8Array( event.target.result ) );
                let query = 'SELECT `websitelink` AS `key.combined`, `website` AS `title.connector`, `title` AS `title.manga`, `link` AS `key.manga` FROM `favorites`;';
                let result = db.exec( query );
                console.log( result );
            };
            fileReader.readAsArrayBuffer( file );
        }

        /**
         * Find the corresponding HakuNeko connector ID for the given FMD website ID
         */
        mapFMDConnectorID( connectorFMD ) {
            switch( connectorFMD ) {
                case 'mangadex': return 'mangadex';
                default: return connectorFMD;
            }
        }

        /**
         * Find the corresponding HakuNeko connector ID for the given FMD website ID
         */
        mapFMDMangaID( connectorFMD, mangaFMD ) {
            switch( connectorFMD ) {
                case 'mangadex': return mangaFMD.match( /manga\/\d+\/$/ )[0];
                default: return mangaFMD;
            }
        }
    }
    BookmarkImporter; // reference the class to prevent removal of the class through js-minify

</script>