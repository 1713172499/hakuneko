<link rel="import" href="../base/storage.html">

<script>

    /**
     *
     */
    class StorageElectron extends StorageBase {

        /**
         *
         */
        constructor() {
            super();
            let electron = require( 'electron' );
            this.dialog = electron.remote.dialog;
            this.fs = electron.remote.require( 'fs' );
            this.path = electron.remote.require( 'path' );
            this.archiver = electron.remote.require( 'archiver' );
        }

        /**
         * https://github.com/electron/electron/blob/master/docs/api/dialog.md
         */
        folderBrowser( rootPath ) {
            let directory = this.dialog.showOpenDialog( {
                title: 'Download Directory for Mangas',
                //message: 'MESSAGE',
                defaultPath: rootPath,
                properties: ['openDirectory']
            });
            return ( directory && directory.length > 0 ? directory[0] : rootPath );
        }

        /**
         * Determine status for each manga in the given list and add a field to the manga with the corresponding status.
         */
        applyMangaStatus( connector, mangas ) {
            mangas.forEach( ( manga ) => {
                manga['status'] = DownloadStatus.available;
            });
        }

        /**
         * Determine status for each chapter in the given list and add a field to the chapter with the corresponding status.
         */
        applyChapterStatus( connector, manga, chapters ) {
            chapters.forEach( ( chapter ) => {
                chapter['status'] = DownloadStatus.available;
            });
        }

        /**
         * 
         */
        saveFile( file, content, callback ) {
            //
        }

        /**
         * 
         */
        createZip( file ) {
            let zip = archiver( 'zip', {
                zlib: {
                    level: 0
                }
            });
            zip.pipe( fs.createWriteStream( directory + '.cbz' ) );
            return zip;
        }
    }

</script>