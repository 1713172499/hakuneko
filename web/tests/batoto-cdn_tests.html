<link rel="import" href="./_testing.html">
<link rel="import" href="../lib/hakuneko/engine/loader.html">
<link rel="import" href="../lib/hakuneko/engine/base/connectors/batoto-cdn.html">

<script>

    // wrap in scope to ensure declared variables/functions do not collide with other tests
    {
        let test = new TestCollection( 'Batoto-CDN Tests' );
        test.register( '_getMangaList' );
        test.register( '_getChapterList' );
        test.register( '_getPageList' );

        let batoto = new BatotoCDN();
        batoto._getMangaList( ( error, mangas ) => {
            test.run( '_getMangaList', () => {
                Assert.equal( null, error, ( error ? error.message : '' ) );
                Assert.nequal( undefined, mangas, 'Failed to get manga list from BatotoCDN' );
                Assert.nequal( undefined, mangas.length, 'Invalid length of manga list from BatotoCDN' );
                Assert.nequal( 0, mangas.length, 'Empty manga list from BatotoCDN' );
                // TODO (2017-10-05): iterate through all mangas and check valid url
            });
            //let manga = mangas[16];
            let manga = mangas[Math.floor( Math.random() * mangas.length )];
            console.log( 'batoto-cdn', manga );
            batoto._getChapterList( manga, ( error, chapters ) => {
                test.run( '_getChapterList', () => {
                    Assert.equal( null, error, ( error ? error.message : '' ) );
                    Assert.nequal( undefined, chapters, 'Failed to get chapter list from BatotoCDN' );
                    Assert.nequal( undefined, chapters.length, 'Invalid length of chapter list from BatotoCDN' );
                    Assert.nequal( 0, chapters.length, 'Empty chapter list from BatotoCDN' );
                    // TODO (2017-10-05): iterate through all chapters and check valid url
                });
                //let chapter = chapters[8];
                let chapter = chapters[Math.floor( Math.random() * chapters.length )];
                console.log( 'batoto-cdn', chapter );
                batoto._getPageList( manga, chapter, ( error, pages ) => {
                    test.run( '_getPageList', () => {
                        Assert.equal( null, error, ( error ? error.message : '' ) );
                        Assert.nequal( undefined, pages, 'Failed to get page list from BatotoCDN' );
                        Assert.nequal( undefined, pages.length, 'Invalid length of page list from BatotoCDN' );
                        Assert.nequal( 0, pages.length, 'Empty page list from BatotoCDN' );
                        // TODO (2017-10-05): iterate through all pages and check valid url
                    });
                });
            });
        });
    }

</script>