<link rel="import" href="init.html">
<link rel="import" href="request.html">
<link rel="import" href="settings.html">
<link rel="import" href="storage.html">
<link rel="import" href="blacklist.html">
<link rel="import" href="history.html">
<link rel="import" href="downloader.html">
<link rel="import" href="connectors.html">
<link rel="import" href="bookmarks.html">
<link rel="import" href="chaptermarks.html">

<script>

    /**
     * Inverse of control container providing instances of all important engine modules.
     * Each module may depend on the corresponding underlying platform.
     */
    class HakuNeko {

        /**
         *
         */
        static get Connectors() {
            if( !this._instanceConnectors ) {
                this._instanceConnectors = ( new Connectors() ).list;
            }
            return this._instanceConnectors;
        }

        /**
         *
         */
        static get DownloadManager() {
            if( !this._instanceDownloadManager ) {
                this._instanceDownloadManager = new DownloadManager();
            }
            return this._instanceDownloadManager;
        }

        /**
        *
        */
        static get BookmarkManager() {
            if( !this._instanceBookmarkManager ) {
                this._instanceBookmarkManager = new BookmarkManager();
            }
            return this._instanceBookmarkManager;
        }

        /**
         *
         */
        static get ChaptermarkManager() {
            if( !this._instanceChaptermarkManager ) {
                this._instanceChaptermarkManager = new ChaptermarkManager();
            }
            return this._instanceChaptermarkManager;
        }

        /**
         *
         */
        static get Request() {
            if( !this._instanceRequest ) {
                this._instanceRequest = new RequestElectron();
            }
            return this._instanceRequest;
        }

        /**
         *
         */
        static get Settings() {
            if( !this._instanceSettings ) {
                this._instanceSettings = new Settings();
            }
            return this._instanceSettings;
        }

        /**
         *
         */
        static get Storage() {
            if( !this._instanceStorage ) {
                this._instanceStorage = new Storage();
            }
            return this._instanceStorage;
        }

        /**
         *
         */
        static get Blacklist() {
            if( !this._instanceBlacklist ) {
                this._instanceBlacklist = new Blacklist();
            }
            return this._instanceBlacklist;
        }
    }

    // alias for support of obsolete usage
    const Engine = HakuNeko;

    new HistoryWorker();
    HakuNeko.Settings.loadProfile( 'default', undefined );
    HakuNeko.BookmarkManager.loadProfile( 'default', undefined );
    HakuNeko.ChaptermarkManager.loadChaptermarks( undefined );

</script>